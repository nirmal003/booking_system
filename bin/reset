#!/usr/bin/env node

/**
 * Database Reset Script
 * Undoes all migrations, re-runs them, and seeds the database
 */

const { exec } = require('child_process');
const path = require('path');

const commands = [
  { name: 'Undoing all migrations', cmd: 'npx sequelize-cli db:migrate:undo:all' },
  { name: 'Running migrations', cmd: 'npx sequelize-cli db:migrate' },
  { name: 'Seeding database', cmd: 'npx sequelize-cli db:seed:all' }
];

console.log('üîÑ Resetting database...\n');

function runCommand(index) {
  if (index >= commands.length) {
    console.log('\n‚úÖ Database reset completed successfully!\n');
    process.exit(0);
    return;
  }

  const { name, cmd } = commands[index];
  console.log(`üìå ${name}...`);

  exec(cmd, { cwd: path.join(__dirname, '..') }, (error, stdout, stderr) => {
    if (error) {
      console.error(`‚ùå ${name} failed:`, error.message);
      process.exit(1);
    }

    if (stderr) {
      console.error(stderr);
    }

    console.log(stdout);
    runCommand(index + 1);
  });
}

runCommand(0);
